---
import { getCollection } from "astro:content";
import Botones from "./Botones.astro";

const categoryOrder = [
  "Hamburguesas",
  "Hot Dogs",
  "Bebidas",
  "Otros",
  "Extras",
];
const allDishes = await getCollection("menu");

const sortedDishes = allDishes.sort((a, b) => {
  const orderA = a.data.order ?? 99;
  const orderB = b.data.order ?? 99;
  return orderA - orderB;
});

const groupedMenu = categoryOrder.reduce(
  (acc, category) => {
    const dishes = sortedDishes.filter(
      (dish) => dish.data.category === category,
    );
    if (dishes.length > 0) {
      acc[category] = dishes;
    }
    return acc;
  },
  {} as Record<string, typeof allDishes>,
);

const otherCategories = sortedDishes.filter(
  (dish) => !categoryOrder.includes(dish.data.category),
);

if (otherCategories.length > 0) {
  const others = otherCategories.reduce(
    (acc, dish) => {
      const category = dish.data.category;
      if (!acc[category]) {
        acc[category] = [];
      }
      acc[category].push(dish);
      return acc;
    },
    {} as Record<string, typeof allDishes>,
  );
  Object.assign(groupedMenu, others);
}
---

<main class="bg-fondo min-h-screen p-8">
  <h1 class="text-3xl font-bold text-white justify-center flex mb-8">
    Nuestro Men√∫
  </h1>

  <div class="container mx-auto max-w-5xl">
    <Botones />

    <div id="menu-container">
      {
        Object.entries(groupedMenu).map(([category, dishes]) => (
          <section
            id={category.toLowerCase().replace(/\s+/g, "-")}
            class="mb-12 category-section scroll-mt-32"
            data-category={category}
          >
            <h2 class="text-3xl font-bold text-amber-500 mb-6 border-b border-white/10 pb-2 uppercase">
              {category}
            </h2>
            <div class="grid gap-4 md:grid-cols-2 items-start">
              {dishes.map((dish) => {
                const { title, price, description, img } = dish.data;
                return (
                  <article
                    class="menu-item group relative bg-[#121212] border border-white/5 rounded-2xl p-5 transition-all duration-300 ease-out hover:border-amber-500/50 hover:-translate-y-2 hover:shadow-[0_20px_40px_rgba(0,0,0,0.7)] fade-in flex flex-col"
                    data-category={category}
                  >
                    <div class="flex flex-col h-full">
                      <h2 class="text-2xl font-black mb-3 leading-none text-white uppercase group-hover:text-amber-500 transition-colors">
                        {title}
                      </h2>
                      <p class="text-sm text-zinc-400 leading-relaxed mb-6">
                        {description}
                      </p>
                      {img && img.trim() !== "" && (
                        <div class="mb-4 overflow-hidden rounded-lg">
                          <img
                            src={img}
                            alt={title}
                            class="w-full h-full object-fit transition-transform duration-500 group-hover:scale-110"
                          />
                        </div>
                      )}
                      <div class="mt-auto pt-4 border-t border-white/10 flex justify-between items-center">
                        <div class="flex flex-col">
                          <span class="text-[10px] text-zinc-500 uppercase font-bold tracking-widest">
                            Precio
                          </span>
                          <span class="text-2xl font-black text-white">
                            ${price}
                          </span>
                        </div>
                      </div>
                    </div>
                  </article>
                );
              })}
            </div>
          </section>
        ))
      }
    </div>
  </div>
</main>
